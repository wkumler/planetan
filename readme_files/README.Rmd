---
title: "Welcome to [`planetan`](https://wkumler.shinyapps.io/planetan/)!"
output: github_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../")})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r vign images, eval=FALSE}
library(plotly)

globe_plates <- readRDS("readme_files/demo_world.rds")
all_builds <- readRDS("readme_files/demo_builds.rds")

theta <- seq(0, 6 * pi, length.out = 720) 
r <- sqrt(1.5^2 - (0.8*sin(theta/3))^2)
cam_coords <- data.frame(x = r*cos(theta), y = r*sin(theta), z = 0.8*sin(theta/3))

set_axis <- list(range=max(abs(globe_plates$vertices))*c(-1.05, 1.05),
                 autorange=FALSE, showspikes=FALSE,
                 showgrid=FALSE, zeroline=FALSE, visible=FALSE)
base_ply <- plot_ly() %>%
  add_trace(type="mesh3d", data = globe_plates,
            x=~vertices$x, y=~vertices$y, z=~vertices$z,
            i=~faces$i, j=~faces$j, k=~faces$k,
            facecolor=rgb(t(col2rgb(globe_plates$faces$color)),
                          maxColorValue = 255),
            lighting=list(diffuse=1),
            hoverinfo="none") %>%
  add_trace(type="mesh3d", data = all_builds,
            x=~vertices$x, y=~vertices$y, z=~vertices$z,
            i=~faces$i, j=~faces$j, k=~faces$k,
            facecolor=rgb(t(col2rgb(all_builds$faces$color)),
                          maxColorValue = 255),
            lighting=list(diffuse=1),
            hoverinfo="none")
for(i in seq(1, 720)){
  ply <- base_ply %>%
    layout(scene=list(
      xaxis=set_axis, yaxis=set_axis, zaxis=set_axis,
      aspectmode='cube',
      camera=list(eye=list(x=cam_coords$x[i], y=cam_coords$y[i], z=cam_coords$z[i])),
      bgcolor="black"
    ),
    margin=list(l=0, r=0, b=0, t=0, pad=0),
    showlegend=FALSE) %>%
    config(displayModeBar = FALSE)
  orca(ply, file = sprintf("readme_files/frame%03d.png", i))
  i <- (i + 1) %% 720
  print(i)
}


library(magick)
img_paths <- list.files("readme_files", full.names=TRUE, pattern = "frame\\d+\\.png$")
imgs <- image_read(img_paths)

webp_anim <- image_animate(imgs, fps = 15, optimize = TRUE)
image_write(webp_anim, "rotation_lossy.webp", format = "webp")
image_write(webp_anim, "rotation_full.webp", format = "webp", defines = c("webp:lossless"="true"))

webp_anim <- image_trim(webp_anim)
image_write(webp_anim, "rotation_trimmed.webp", format = "webp")

smoothed <- image_morph(imgs, frames = length(imgs) * 2)
webp_anim <- image_animate(imgs, fps = 30, optimize = TRUE)
webp_anim <- image_trim(webp_anim)
image_write(webp_anim, "rotation_smoothed.webp", format = "webp", defines = c("webp:lossless"="true"))

# file.remove(img_paths)
```

<img src="readme_files/rotation_lossy.webp" align="right" style="width: 40%; height: auto; z-index: 1000;">

## Colonize an entire low-poly planet!

`planetan` is a game about colonization. Claim resources from the tiles you've settled on to build new roads and settlements elsewhere on the globe. Upgrade your settlements to cities with ore and wheat to double your income from them!

## Online multiplayer competition

Team up with your friends anywhere in the world and challenge each other to achieve 10 points first. Earn points by building settlements and cities or by getting lucky when drawing development cards. Be careful though - your competition may become your only way to trade for precious resources!

<div clear="right"/>

<img src="readme_files/gameplay_ss.png">

<img src="readme_files/start_screenshot.png" align="right" style="width: 30%; height: auto; z-index: 1000;">

## Synchronous and asynchronous gameplay

Not all online at the same time? Start a game whenever, send friends the secret code, and log in whenever - your progress is saved automatically and can be restarted whenever you've got time.

## Get started online at https://wkumler.shinyapps.io/planetan/

...at least until I run out of Shinyapps hours!
